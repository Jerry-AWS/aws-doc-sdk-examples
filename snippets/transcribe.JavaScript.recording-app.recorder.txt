
// Functions for recording transcriptions.
// Enable microphone on browser.
require("./helper.ts");
const index = require("./index.ts");
const {
  CognitoIdentityProviderClient,
  GetUserCommand,
} = require("@aws-sdk/client-cognito-identity-provider");
navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
  handlerFunction(stream);
});

// This is a handler function to manage recordings.
function handlerFunction(stream) {
  rec = new MediaRecorder(stream);
  rec.ondataavailable = (e) => {
    audioChunks.push(e.data);
    if (rec.state == "inactive") {
      let blob = new Blob(audioChunks, { type: "audio/mpeg-3" });
      var recordedAudio = document.getElementById("recordedAudio");
      recordedAudio.src = URL.createObjectURL(blob);
      recordedAudio.controls = true;
      recordedAudio.autoplay = true;
      // Take username from 'index.ts'.
      var username = index.username;
      // The upload function is in 'index.ts'.
      upload(blob, username);
      alert("Refresh page in ~1 min to view your transcription.");
    }
  };
}

// Start recording.
window.startRecord = function () {
  console.log("Recording started");
  var record = document.getElementById("record");
  var stop = document.getElementById("stopRecord");
  record.disabled = true;
  record.style.backgroundColor = "blue";
  stop.disabled = false;
  audioChunks = [];
  rec.start();
};

// Stop recording.
window.stopRecord = function () {
  console.log("Recording stopped");
  var record = document.getElementById("record");
  var stop = document.getElementById("stopRecord");
  record.disabled = false;
  stop.disabled = true;
  record.style.backgroundColor = "red";
  rec.stop();
};

