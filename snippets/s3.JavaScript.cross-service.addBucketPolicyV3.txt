// Import required AWS SDK clients and commands for Node.js
const {
  IAMClient,
  AttachRolePolicyCommand,
  CreatePolicyCommand,
} = require("@aws-sdk/client-iam");

// Set the AWS Region
const REGION = "REGION"; //e.g. "us-east-1"
const bucketName = "BUCKET_NAME";
const myManagedPolicy = {
  Version: "2012-10-17",
  Statement: [
    {
      Sid: "VisualEditor0",
      Effect: "Allow",
      Action: ["sns:Publish", "dynamodb:PutItem"],
      Resource: "*",
    },
    {
      Sid: "VisualEditor1",
      Effect: "Allow",
      Action: "s3:GetObject",
      Resource: "arn:aws:s3:::" + bucketName + "/*",
    },
  ],
};

const params = {
  PolicyDocument: JSON.stringify(myManagedPolicy),
  PolicyName: "POLICY_NAME",
};

// Create the IAM service object
var iam = new IAMClient({});

const run = async () => {
  try {
    // Create the IAM policy
    const data = await iam.send(new CreatePolicyCommand(params));
    console.log("Policy created", data.Policy.Arn);
    const policy = data.Policy.Arn;
    try {
      // Set the parameters for attaching the IAM policy to an IAM role
      const attachParams = {
        PolicyArn: policy,
        RoleName: "ROLE_NAME",
      };
      // Attach the IAM policy to a role
      const data = await iam.send(new AttachRolePolicyCommand(attachParams));
      console.log("Policy attached successfully");
    } catch (err) {
      console.log("Unable to attach policy to role", err);
    }
  } catch (err) {
    console.log("Error", err);
  }
};
run();

